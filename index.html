<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTPGet | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0F172A; font-family: 'Segoe UI', sans-serif; color: white; }
        .card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .glow { box-shadow: 0 0 15px rgba(99, 102, 241, 0.3); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <h1 class="text-3xl font-bold text-indigo-400"><i class="fa-solid fa-bolt-lightning mr-2"></i>OTPGet <span class="text-white font-light">PRO</span></h1>
            <div class="card px-6 py-3 rounded-2xl flex items-center gap-4 glow">
                <span class="text-gray-400 text-sm">BALANCE</span>
                <span id="bal" class="text-2xl font-mono font-bold text-green-400">$0.00</span>
                <button onclick="checkBalance()" class="text-indigo-400 hover:rotate-180 transition-all duration-500"><i class="fa-solid fa-sync"></i></button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="card p-6 rounded-3xl">
                <h2 class="text-xl font-semibold mb-6">Create Order</h2>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">SERVICE</label>
                        <select id="service" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-xl focus:border-indigo-500 outline-none">
                            <option value="wa">WhatsApp</option>
                            <option value="tg">Telegram</option>
                            <option value="go">Google</option>
                            <option value="fb">Facebook</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">COUNTRY ID</label>
                        <input type="number" id="country" value="22" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-xl outline-none" placeholder="e.g. 22 for India">
                    </div>
                    <button onclick="getNumber()" id="mainBtn" class="w-full bg-indigo-600 hover:bg-indigo-500 py-4 rounded-2xl font-bold shadow-lg shadow-indigo-500/20 transition-all">
                        GET NUMBER
                    </button>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-6">
                <div id="activePanel" class="card p-8 rounded-3xl border-indigo-500/30 hidden">
                    <div class="text-center">
                        <p class="text-gray-400 text-sm uppercase mb-2">Your Virtual Number</p>
                        <div class="flex items-center justify-center gap-4 mb-6">
                            <h3 id="num" class="text-4xl md:text-5xl font-mono font-bold text-white tracking-tighter">---</h3>
                            <button onclick="copy('num')" class="text-gray-500 hover:text-white"><i class="fa-regular fa-copy text-xl"></i></button>
                        </div>
                        
                        <div class="bg-slate-900/80 p-6 rounded-2xl border border-dashed border-slate-700 mb-6">
                            <p class="text-xs text-gray-500 mb-2">OTP CODE</p>
                            <div id="otpDisplay" class="text-5xl font-black text-indigo-400 tracking-[10px]">WAITING</div>
                            <div id="loader" class="mt-4 animate-pulse text-xs text-indigo-300">Checking server for SMS...</div>
                        </div>

                        <div class="flex gap-4">
                            <button onclick="cancel()" class="flex-1 py-3 rounded-xl bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20 transition">Cancel</button>
                            <button onclick="finish()" class="flex-1 py-3 rounded-xl bg-green-500/10 text-green-500 border border-green-500/20 hover:bg-green-500/20 transition">Finish</button>
                        </div>
                    </div>
                </div>

                <div class="card p-4 rounded-2xl h-48 overflow-y-auto font-mono text-xs text-gray-400" id="logs">
                    <div>> System ready. Check balance to start.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let orderId = null;
        let poller = null;

        async function callApi(params) {
            try {
                // Local PHP file ko call karega
                const res = await fetch('api.php?' + params);
                return await res.text();
            } catch (e) {
                addLog("Local API Error. Make sure api.php is uploaded.", "red");
                return "ERROR";
            }
        }

        async function checkBalance() {
            const res = await callApi("action=getBalance");
            if(res.includes("ACCESS_BALANCE")) {
                const b = res.split(":")[1];
                document.getElementById('bal').innerText = "$" + b;
                addLog("Balance Updated: $" + b, "green");
            }
        }

        async function getNumber() {
            const s = document.getElementById('service').value;
            const c = document.getElementById('country').value;
            const btn = document.getElementById('mainBtn');
            
            btn.disabled = true;
            btn.innerText = "REQUESTING...";

            const res = await callApi(`action=getNumber&service=${s}&country=${c}`);
            
            if(res.includes("ACCESS_NUMBER")) {
                const p = res.split(":");
                orderId = p[1];
                document.getElementById('num').innerText = p[2];
                document.getElementById('activePanel').classList.remove('hidden');
                addLog("Number Received: " + p[2]);
                startWaiting();
            } else {
                addLog("Error: " + res, "red");
                alert("Error: " + res);
            }
            btn.disabled = false;
            btn.innerText = "GET NUMBER";
        }

        function startWaiting() {
            if(poller) clearInterval(poller);
            document.getElementById('otpDisplay').innerText = "WAITING";
            document.getElementById('loader').classList.remove('hidden');
            
            poller = setInterval(async () => {
                const res = await callApi("action=getStatus&id=" + orderId);
                if(res.includes("STATUS_OK")) {
                    const otp = res.split(":")[1];
                    document.getElementById('otpDisplay').innerText = otp;
                    document.getElementById('loader').classList.add('hidden');
                    addLog("OTP RECEIVED: " + otp, "green");
                    clearInterval(poller);
                } else if(res === "STATUS_CANCEL") {
                    addLog("Order Cancelled", "red");
                    reset();
                }
            }, 4000);
        }

        async function cancel() {
            await callApi(`action=setStatus&status=8&id=${orderId}`);
            reset();
        }

        async function finish() {
            await callApi(`action=setStatus&status=6&id=${orderId}`);
            reset();
        }

        function reset() {
            clearInterval(poller);
            orderId = null;
            document.getElementById('activePanel').classList.add('hidden');
        }

        function addLog(msg, color = "gray") {
            const l = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            l.innerHTML = `<div style="color:${color}">[${time}] ${msg}</div>` + l.innerHTML;
        }

        function copy(id) {
            const t = document.getElementById(id).innerText;
            navigator.clipboard.writeText(t);
            addLog("Copied: " + t);
        }

        window.onload = checkBalance;
    </script>
</body>
</html>